# AI-Native 改造任务跟踪清单

> 使用此清单跟踪改造进度，确保每个阶段都按计划完成。

---

## 📅 总体进度

```
Phase 0 [████████████████████] 100%  准备阶段
Phase 1 [░░░░░░░░░░░░░░░░░░░░]   0%  数据库扩展
Phase 2 [░░░░░░░░░░░░░░░░░░░░]   0%  初评关卡系统
Phase 3 [░░░░░░░░░░░░░░░░░░░░]   0%  语言分支优化
Phase 4 [░░░░░░░░░░░░░░░░░░░░]   0%  短文优化路径
Phase 5 [░░░░░░░░░░░░░░░░░░░░]   0%  反馈机制（可选）
Phase 6 [░░░░░░░░░░░░░░░░░░░░]   0%  监控和优化

总体进度: [███░░░░░░░░░░░░░░░░]  14%
```

---

## Phase 0: 准备阶段 (1天)

### 环境检查

| 任务 | 状态 | 负责人 | 完成日期 | 备注 |
|------|------|--------|----------|------|
| Node.js 版本检查 | ☐ | | | 需要 >= 20.0.0 |
| Redis 连接测试 | ☐ | | | redis-cli ping |
| 数据库连接测试 | ☐ | | | npm run db:studio |
| 依赖完整性检查 | ☐ | | | npm install |
| 现有测试运行 | ☐ | | | npm run test |
| 基准性能测试 | ☐ | | | 记录当前数据 |

### 交付物

| 交付物 | 状态 | 位置 |
|--------|------|------|
| 环境检查报告 | ☐ | docs/ENV-CHECK.md |
| 基准性能数据 | ☐ | docs/BASELINE-METRICS.md |

---

## Phase 1: 数据库扩展 (1天)

### Schema 设计

| 任务 | 状态 | 负责人 | 完成日期 | 备注 |
|------|------|--------|----------|------|
| 设计初评字段 | ☐ | | | Entry 模型扩展 |
| 更新 schema.prisma | ☐ | | | 添加 7 个新字段 |
| 生成 Prisma Client | ☐ | | | npm run db:generate |
| 开发环境推送 | ☐ | | | npm run db:push |
| 生产环境迁移 | ☐ | | | npm run db:migrate |
| Schema 验证测试 | ☐ | | | 读写测试 |

### 新增字段清单

```prisma
model Entry {
  aiPrelimIgnore      Boolean?  @map("ai_prelim_ignore")
  aiPrelimReason      String?   @map("ai_prelim_reason") @db.Text
  aiPrelimValue       Int?      @map("ai_prelim_value")
  aiPrelimSummary     String?   @map("ai_prelim_summary") @db.Text
  aiPrelimLanguage    String?   @map("ai_prelim_language")
  aiPrelimStatus      String?   @map("ai_prelim_status")
  aiPrelimAnalyzedAt  DateTime? @map("ai_prelim_analyzed_at")
}
```

### 交付物

| 交付物 | 状态 | 位置 |
|--------|------|------|
| 更新的 schema.prisma | ☐ | prisma/schema.prisma |
| 迁移脚本 | ☐ | prisma/migrations/ |
| 验证测试 | ☐ | scripts/test-schema.ts |

---

## Phase 2: 初评关卡系统 (2-3天)

### 2.1 PreliminaryEvaluator 实现

| 任务 | 状态 | 负责人 | 完成日期 | 备注 |
|------|------|--------|----------|------|
| 创建类文件 | ☐ | | | lib/ai/preliminary-evaluator.ts |
| 实现 evaluate() 方法 | ☐ | | | 核心评估逻辑 |
| 实现语言检测 | ☐ | | | detectLanguage() |
| 实现模型选择 | ☐ | | | selectModel() |
| 实现提示词构建 | ☐ | | | buildPrompt() |
| 单元测试 | ☐ | | | 覆盖率 > 80% |

### 2.2 ModelSelector 实现

| 任务 | 状态 | 负责人 | 完成日期 | 备注 |
|------|------|--------|----------|------|
| 创建类文件 | ☐ | | | lib/ai/model-selector.ts |
| 实现 selectModel() | ☐ | | | 语言+阶段选择 |
| 定义接口类型 | ☐ | | | ModelConfig, AnalysisStage |
| 单元测试 | ☐ | | | 各语言+阶段组合 |

### 2.3 初评队列处理器

| 任务 | 状态 | 负责人 | 完成日期 | 备注 |
|------|------|--------|----------|------|
| 创建队列文件 | ☐ | | | lib/queue/preliminary-processor.ts |
| 实现 Worker 逻辑 | ☐ | | | 并发 5 个任务 |
| 实现队列操作函数 | ☐ | | | add, addBatch, getStatus |
| 错误处理 | ☐ | | | 重试机制 |
| 集成测试 | ☐ | | | 端到端测试 |

### 2.4 API 路由

| 任务 | 状态 | 负责人 | 完成日期 | 备注 |
|------|------|--------|----------|------|
| 创建 tRPC 路由 | ☐ | | | server/api/preliminary.ts |
| 实现 trigger | ☐ | | | 单个文章触发 |
| 实现 triggerBatch | ☐ | | | 批量触发 |
| 实现 getResult | ☐ | | | 获取初评结果 |
| API 测试 | ☐ | | | Postman/tRPC 测试 |

### 2.5 测试脚本

| 任务 | 状态 | 负责人 | 完成日期 | 备注 |
|------|------|--------|----------|------|
| 创建测试脚本 | ☐ | | | scripts/test-preliminary.ts |
| 测试初评功能 | ☐ | | | 真实文章测试 |
| 测试队列处理 | ☐ | | | 多任务并发 |
| 性能基准测试 | ☐ | | | 处理时间 < 30s |

### 交付物

| 交付物 | 状态 | 位置 |
|--------|------|------|
| PreliminaryEvaluator | ☐ | lib/ai/preliminary-evaluator.ts |
| ModelSelector | ☐ | lib/ai/model-selector.ts |
| 初评队列处理器 | ☐ | lib/queue/preliminary-processor.ts |
| API 路由 | ☐ | server/api/preliminary.ts |
| 测试脚本 | ☐ | scripts/test-preliminary.ts |
| 单元测试 | ☐ | lib/ai/__tests__/ |

### 验收标准

| 标准 | 目标 | 实际 |
|------|------|------|
| 初评功能 | ✅ 正常工作 | ☐ 待验证 |
| 过滤率 | > 30% | ☐ |
| 队列稳定性 | ✅ 无崩溃 | ☐ |
| API 响应 | < 500ms | ☐ |

---

## Phase 3: 语言分支优化 (1-2天)

### 3.1 语言检测增强

| 任务 | 状态 | 负责人 | 完成日期 | 备注 |
|------|------|--------|----------|------|
| 创建语言检测器 | ☐ | | | lib/ai/language-detector.ts |
| 实现 Unicode 检测 | ☐ | | | detectScript() |
| 实现 n-gram 检测 | ☐ | | | detectByNGram() |
| 实现置信度计算 | ☐ | | | calculateConfidence() |
| 支持多种语言 | ☐ | | | zh, en, ja, ko, ru, ar, es, fr |
| 单元测试 | ☐ | | | 准确率 > 95% |

### 3.2 模型配置管理

| 任务 | 状态 | 负责人 | 完成日期 | 备注 |
|------|------|--------|----------|------|
| 创建配置文件 | ☐ | | | lib/ai/model-config.ts |
| 定义模型层级 | ☐ | | | MODEL_TIERS |
| 实现成本计算 | ☐ | | | calculateCost() |
| 支持多提供商 | ☐ | | | OpenAI, Anthropic, DeepSeek, Gemini |
| 配置验证 | ☐ | | | 环境变量检查 |

### 3.3 流程集成

| 任务 | 状态 | 负责人 | 完成日期 | 备注 |
|------|------|--------|----------|------|
| 更新深度分析处理器 | ☐ | | | deep-analysis-processor.ts |
| 集成语言检测 | ☐ | | | 处理前检测语言 |
| 集成模型选择 | ☐ | | | 动态选择模型 |
| 更新工作流引擎 | ☐ | | | workflow/engine.ts |
| 集成测试 | ☐ | | | 多语言文章测试 |

### 交付物

| 交付物 | 状态 | 位置 |
|--------|------|------|
| 语言检测器 | ☐ | lib/ai/language-detector.ts |
| 模型配置 | ☐ | lib/ai/model-config.ts |
| 更新的处理器 | ☐ | lib/queue/deep-analysis-processor.ts |

### 验收标准

| 标准 | 目标 | 实际 |
|------|------|------|
| 语言检测准确率 | > 95% | ☐ |
| 中文准确率提升 | +7% | ☐ |
| 英文准确率提升 | +15% | ☐ |
| 成本计算准确 | ✅ 无误差 | ☐ |

---

## Phase 4: 短文优化路径 (1-2天)

### 4.1 SmartAnalyzer 实现

| 任务 | 状态 | 负责人 | 完成日期 | 备注 |
|------|------|--------|----------|------|
| 创建智能分析器 | ☐ | | | lib/ai/smart-analyzer.ts |
| 实现短文路径 | ☐ | | | analyzeShort() |
| 实现分段路径 | ☐ | | | analyzeSegmented() |
| 实现长文路径 | ☐ | | | analyzeLong() |
| 实现结果合并 | ☐ | | | mergeResults() |
| 实现去重逻辑 | ☐ | | | deduplicatePoints() |

### 4.2 性能测试

| 任务 | 状态 | 负责人 | 完成日期 | 备注 |
|------|------|--------|----------|------|
| 创建测试脚本 | ☐ | | | scripts/test-smart-analyzer.ts |
| 短文性能测试 | ☐ | | | < 6000 字符 |
| 中文性能测试 | ☐ | | | 6000-12000 字符 |
| 长文性能测试 | ☐ | | | > 12000 字符 |
| 对比基准测试 | ☐ | | | vs SegmentedAnalyzer |
| 质量对比测试 | ☐ | | | 分析质量不降低 |

### 交付物

| 交付物 | 状态 | 位置 |
|--------|------|------|
| SmartAnalyzer | ☐ | lib/ai/smart-analyzer.ts |
| 测试脚本 | ☐ | scripts/test-smart-analyzer.ts |
| 性能报告 | ☐ | docs/PERFORMANCE-REPORT.md |

### 验收标准

| 标准 | 目标 | 实际 |
|------|------|------|
| 短文速度提升 | > 40% | ☐ |
| 分析质量 | ✅ 不降低 | ☐ |
| 长文处理 | ✅ 不变慢 | ☐ |

---

## Phase 5: 反馈机制 (可选, 2-3天)

### 5.1 FeedbackEngine 实现

| 任务 | 状态 | 负责人 | 完成日期 | 备注 |
|------|------|--------|----------|------|
| 创建反馈引擎 | ☐ | | | lib/ai/feedback-engine.ts |
| 实现反馈整合 | ☐ | | | improveWithFeedback() |
| 实现反馈应用 | ☐ | | | applyUserFeedback() |
| 实现反馈保存 | ☐ | | | saveFeedback() |
| 单元测试 | ☐ | | | 覆盖率 > 80% |

### 5.2 前端组件

| 任务 | 状态 | 负责人 | 完成日期 | 备注 |
|------|------|--------|----------|------|
| 创建反馈组件 | ☐ | | | components/ai/AnalysisFeedback.tsx |
| 实现评分 UI | ☐ | | | 1-5 星评分 |
| 实现问题反馈 | ☐ | | | 摘要问题输入 |
| 实现标签建议 | ☐ | | | 标签推荐输入 |
| 实现意见收集 | ☐ | | | 自由文本输入 |
| 样式优化 | ☐ | | | 响应式设计 |

### 5.3 API 路由

| 任务 | 状态 | 负责人 | 完成日期 | 备注 |
|------|------|--------|----------|------|
| 创建反馈 API | ☐ | | | server/api/feedback.ts |
| 实现提交接口 | ☐ | | | submitFeedback |
| 实现统计接口 | ☐ | | | getFeedbackStats |
| API 测试 | ☐ | | | 功能测试 |

### 5.4 数据模型

| 任务 | 状态 | 负责人 | 完成日期 | 备注 |
|------|------|--------|----------|------|
| 创建 Feedback 模型 | ☐ | | | prisma/schema.prisma |
| 数据库迁移 | ☐ | | | npm run db:push |
| 数据验证 | ☐ | | | 完整性测试 |

### 交付物

| 交付物 | 状态 | 位置 |
|--------|------|------|
| FeedbackEngine | ☐ | lib/ai/feedback-engine.ts |
| 反馈组件 | ☐ | components/ai/AnalysisFeedback.tsx |
| 反馈 API | ☐ | server/api/feedback.ts |
| 数据模型 | ☐ | prisma/schema.prisma (扩展) |

### 验收标准

| 标准 | 目标 | 实际 |
|------|------|------|
| 反馈提交 | ✅ 正常工作 | ☐ |
| 反馈应用 | ✅ 优化分析 | ☐ |
| A/B 测试 | ✅ 显示改进 | ☐ |

---

## Phase 6: 监控和优化 (1-2天)

### 6.1 指标收集

| 任务 | 状态 | 负责人 | 完成日期 | 备注 |
|------|------|--------|----------|------|
| 创建指标收集器 | ☐ | | | lib/ai/metrics.ts |
| 定义指标类型 | ☐ | | | AnalysisMetrics |
| 实现记录功能 | ☐ | | | record() |
| 实现统计功能 | ☐ | | | getStats() |
| 集成到各模块 | ☐ | | | 所有关键流程 |

### 6.2 成本分析

| 任务 | 状态 | 负责人 | 完成日期 | 备注 |
|------|------|--------|----------|------|
| 创建成本分析脚本 | ☐ | | | scripts/cost-analysis.ts |
| 实现按模型统计 | ☐ | | | 模型维度成本 |
| 实现按语言统计 | ☐ | | | 语言维度成本 |
| 实现优化建议 | ☐ | | | 自动生成建议 |
| 定期报告 | ☐ | | | 每周生成 |

### 6.3 性能监控

| 任务 | 状态 | 负责人 | 完成日期 | 备注 |
|------|------|--------|----------|------|
| 创建监控器 | ☐ | | | lib/ai/monitor.ts |
| 实现告警检查 | ☐ | | | check() |
| 定义告警规则 | ☐ | | | 慢处理、高成本、错误率 |
| 实现通知机制 | ☐ | | | 日志/邮件/Slack |

### 6.4 监控仪表板

| 任务 | 状态 | 负责人 | 完成日期 | 备注 |
|------|------|--------|----------|------|
| 创建仪表板组件 | ☐ | | | components/dashboard/MetricsDashboard.tsx |
| 实时指标展示 | ☐ | | | 处理中、等待中 |
| 成本趋势图 | ☐ | | | 时间序列 |
| 性能指标图 | ☐ | | | 处理时间分布 |
| 质量指标图 | ☐ | | | 准确率趋势 |

### 交付物

| 交付物 | 状态 | 位置 |
|--------|------|------|
| 指标收集器 | ☐ | lib/ai/metrics.ts |
| 成本分析脚本 | ☐ | scripts/cost-analysis.ts |
| 性能监控器 | ☐ | lib/ai/monitor.ts |
| 监控仪表板 | ☐ | components/dashboard/MetricsDashboard.tsx |

### 验收标准

| 标准 | 目标 | 实际 |
|------|------|------|
| 指标收集 | ✅ 完整 | ☐ |
| 成本计算 | ✅ 准确 | ☐ |
| 异常告警 | ✅ 及时 | ☐ |
| 优化建议 | ✅ 自动 | ☐ |

---

## 📊 总体验收标准

### 功能完整性

| 功能 | 状态 | 备注 |
|------|------|------|
| 初评关卡 | ☐ | 过滤低质内容 |
| 语言分支 | ☐ | 多语言优化 |
| 短文优化 | ☐ | 提升处理速度 |
| 反馈机制 | ☐ | 可选功能 |
| 监控体系 | ☐ | 完整可观测 |

### 性能指标

| 指标 | 目标 | 实际 | 状态 |
|------|------|------|------|
| 深度分析成本降低 | > 35% | __ | ☐ |
| 中文分析准确率 | > 90% | __ | ☐ |
| 英文分析准确率 | > 85% | __ | ☐ |
| 短文处理速度提升 | > 40% | __ | ☐ |
| 队列处理延迟 | < 30s | __ | ☐ |
| 系统稳定性 | > 99% | __ | ☐ |

### 质量标准

| 标准 | 要求 | 实际 | 状态 |
|------|------|------|------|
| 单元测试覆盖率 | > 80% | __ | ☐ |
| 集成测试通过率 | 100% | __ | ☐ |
| 代码审查通过 | ✅ | __ | ☐ |
| 文档完整性 | ✅ | __ | ☐ |

---

## 📝 问题跟踪

### 当前问题

| ID | 问题描述 | 优先级 | 负责人 | 状态 |
|----|---------|--------|--------|------|
| - | - | - | - | - |

### 已解决问题

| ID | 问题描述 | 解决方案 | 解决日期 |

---

## 🎯 里程碑

| 里程碑 | 日期 | 状态 | 备注 |
|--------|------|------|------|
| M1: 环境准备完成 | Day 1 | ☐ | 可以开始开发 |
| M2: 数据库扩展完成 | Day 2 | ☐ | 可以开始 Phase 2 |
| M3: 初评系统上线 | Day 5 | ☐ | 成本开始降低 |
| M4: 语言优化完成 | Day 7 | ☐ | 准确率提升 |
| M5: 短文优化完成 | Day 9 | ☐ | 速度提升 |
| M6: 监控体系完成 | Day 11 | ☐ | 可观测性建立 |
| M7: 全部完成 | Day 14 | ☐ | 项目交付 |

---

## 📌 使用说明

1. **开始前**：阅读 `docs/AI-NATIVE-REFACTOR-PLAN.md` 了解完整计划
2. **进行中**：每完成一个任务，将 ☐ 改为 ☑
3. **遇到问题**：在"问题跟踪"部分记录
4. **完成阶段**：更新进度条和总体进度
5. **定期回顾**：每周更新"当前实际"数据

---

**最后更新**: 2026-02-08
**当前阶段**: Phase 0 - 准备阶段
