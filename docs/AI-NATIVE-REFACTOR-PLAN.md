# AI-Native æ™ºèƒ½æ”¹é€ è¯¦ç»†å®æ–½è®¡åˆ’

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

### æ”¹é€ ç›®æ ‡

åŸºäº BestBlogs é¡¹ç›®çš„ä¼˜ç§€è®¾è®¡æ¨¡å¼ï¼Œå¯¹ Rss-Easy è¿›è¡Œ AI-Native æ™ºèƒ½åŒ–æ”¹é€ ï¼Œå®ç°ï¼š

| æŒ‡æ ‡ | å½“å‰çŠ¶æ€ | ç›®æ ‡çŠ¶æ€ | æå‡ |
|------|---------|---------|------|
| æ·±åº¦åˆ†ææˆæœ¬ | 100% | ~60% | èŠ‚çœ 40% |
| ä¸­æ–‡åˆ†æå‡†ç¡®ç‡ | ~85% | ~92% | +7% |
| è‹±æ–‡åˆ†æå‡†ç¡®ç‡ | ~75% | ~90% | +15% |
| çŸ­æ–‡å¤„ç†é€Ÿåº¦ | 30s | 15s | å¿« 50% |
| ä¸ªæ€§åŒ–æ¨èç²¾åº¦ | åŸºå‡† | +50% CTR | å¤§å¹…æå‡ |

### æ”¹é€ èŒƒå›´

**æ ¸å¿ƒæ¨¡å—**ï¼š
1. åˆè¯„å…³å¡ç³»ç»Ÿï¼ˆæ–°å¢ï¼‰
2. è¯­è¨€åˆ†æ”¯æ¨¡å‹é€‰æ‹©
3. çŸ­æ–‡/é•¿æ–‡åŒè·¯å¾„ä¼˜åŒ–
4. åé¦ˆæ”¹è¿›æœºåˆ¶
5. å·¥ä½œæµå¼•æ“é‡æ„

**æ”¯æŒæ¨¡å—**ï¼š
- é˜Ÿåˆ—ç³»ç»Ÿæ‰©å±•
- æ•°æ®åº“ Schema æ‰©å±•
- API è·¯ç”±æ–°å¢
- å‰ç«¯ç»„ä»¶æ›´æ–°
- ç›‘æ§å’Œæ—¥å¿—

---

## ğŸ¯ æ”¹é€ åŸåˆ™

1. **å‘åå…¼å®¹**ï¼šæ–°åŠŸèƒ½ä¸å½±å“ç°æœ‰ç³»ç»Ÿè¿è¡Œ
2. **æ¸è¿›å¼å®æ–½**ï¼šåˆ†é˜¶æ®µéƒ¨ç½²ï¼Œæ¯ä¸ªé˜¶æ®µå¯ç‹¬ç«‹éªŒè¯
3. **å¯é…ç½®æ€§**ï¼šæ‰€æœ‰æ–°åŠŸèƒ½æ”¯æŒå¼€å…³æ§åˆ¶
4. **å¯è§‚æµ‹æ€§**ï¼šå®Œæ•´çš„æ—¥å¿—å’Œç›‘æ§æŒ‡æ ‡
5. **æˆæœ¬ä¼˜åŒ–**ï¼šä¼˜å…ˆä½¿ç”¨æ€§ä»·æ¯”é«˜çš„æ¨¡å‹

---

## ğŸ“Š é˜¶æ®µåˆ’åˆ†

```
Phase 0: å‡†å¤‡é˜¶æ®µ (1å¤©)
â”œâ”€â”€ ç¯å¢ƒæ£€æŸ¥
â”œâ”€â”€ ä¾èµ–éªŒè¯
â””â”€â”€ åŸºå‡†æµ‹è¯•

Phase 1: æ•°æ®åº“æ‰©å±• (1å¤©)
â”œâ”€â”€ Schema è®¾è®¡
â”œâ”€â”€ è¿ç§»è„šæœ¬
â””â”€â”€ éªŒè¯æµ‹è¯•

Phase 2: åˆè¯„å…³å¡ç³»ç»Ÿ (2-3å¤©)
â”œâ”€â”€ PreliminaryEvaluator å®ç°
â”œâ”€â”€ ModelSelector å®ç°
â”œâ”€â”€ åˆè¯„é˜Ÿåˆ—å¤„ç†å™¨
â””â”€â”€ API è·¯ç”±å’Œæµ‹è¯•

Phase 3: è¯­è¨€åˆ†æ”¯ä¼˜åŒ– (1-2å¤©)
â”œâ”€â”€ è¯­è¨€æ£€æµ‹å·¥å…·
â”œâ”€â”€ æ¨¡å‹é…ç½®ç®¡ç†
â””â”€â”€ é›†æˆæµ‹è¯•

Phase 4: çŸ­æ–‡ä¼˜åŒ–è·¯å¾„ (1-2å¤©)
â”œâ”€â”€ SmartAnalyzer å®ç°
â”œâ”€â”€ æ€§èƒ½ä¼˜åŒ–
â””â”€â”€ å¯¹æ¯”æµ‹è¯•

Phase 5: åé¦ˆæœºåˆ¶ (å¯é€‰, 2-3å¤©)
â”œâ”€â”€ FeedbackEngine å®ç°
â”œâ”€â”€ å‰ç«¯åé¦ˆç»„ä»¶
â””â”€â”€ A/B æµ‹è¯•æ¡†æ¶

Phase 6: ç›‘æ§å’Œä¼˜åŒ– (1-2å¤©)
â”œâ”€â”€ æŒ‡æ ‡æ”¶é›†
â”œâ”€â”€ æ€§èƒ½ç›‘æ§
â””â”€â”€ æˆæœ¬åˆ†æ

æ€»è®¡: 9-14 å¤©
```

---

## ğŸ“ è¯¦ç»†å®æ–½æ­¥éª¤

### Phase 0: å‡†å¤‡é˜¶æ®µ

**æ—¶é—´**: 1 å¤©

**ç›®æ ‡**: ç¡®ä¿å¼€å‘ç¯å¢ƒå°±ç»ªï¼Œå»ºç«‹åŸºå‡†æµ‹è¯•

#### ä»»åŠ¡æ¸…å•

- [ ] **0.1 ç¯å¢ƒæ£€æŸ¥**
  ```bash
  # æ£€æŸ¥ Node.js ç‰ˆæœ¬
  node --version  # éœ€è¦ >= 20.0.0

  # æ£€æŸ¥ Redis è¿æ¥
  redis-cli ping

  # æ£€æŸ¥æ•°æ®åº“è¿æ¥
  npm run db:studio
  ```

- [ ] **0.2 ä¾èµ–éªŒè¯**
  ```bash
  # å®‰è£…æ–°ä¾èµ–
  npm install --save-dev langdetect  # è¯­è¨€æ£€æµ‹
  npm install                       # ç¡®ä¿ç°æœ‰ä¾èµ–å®Œæ•´
  ```

- [ ] **0.3 åŸºå‡†æµ‹è¯•**
  ```bash
  # è¿è¡Œç°æœ‰æµ‹è¯•
  npm run test:coverage

  # æµ‹è¯•æ·±åº¦åˆ†æåŠŸèƒ½
  npm run test:deep-analysis

  # è®°å½•åŸºå‡†æ•°æ®
  # - å¹³å‡å¤„ç†æ—¶é—´
  # - æ¯ç¯‡æ–‡ç« æˆæœ¬
  # - å‡†ç¡®ç‡ï¼ˆæŠ½æ ·ï¼‰
  ```

#### äº¤ä»˜ç‰©

- [ ] ç¯å¢ƒæ£€æŸ¥æŠ¥å‘Š
- [ ] åŸºå‡†æ€§èƒ½æ•°æ®
- [ ] ä¾èµ–æ¸…å•

#### éªŒæ”¶æ ‡å‡†

- âœ… æ‰€æœ‰ç¯å¢ƒæ£€æŸ¥é€šè¿‡
- âœ… åŸºå‡†æµ‹è¯•æ•°æ®å·²è®°å½•
- âœ… å¼€å‘ç¯å¢ƒå¯æ­£å¸¸å¯åŠ¨

---

### Phase 1: æ•°æ®åº“æ‰©å±•

**æ—¶é—´**: 1 å¤©

**ç›®æ ‡**: æ‰©å±•æ•°æ®åº“ Schemaï¼Œæ”¯æŒåˆè¯„å’Œè¯­è¨€æ£€æµ‹

#### ä»»åŠ¡æ¸…å•

- [ ] **1.1 Schema è®¾è®¡**

  åœ¨ `prisma/schema.prisma` ä¸­æ·»åŠ åˆè¯„å­—æ®µï¼š

  ```prisma
  model Entry {
    // ... ç°æœ‰å­—æ®µ

    // ========== åˆè¯„å­—æ®µï¼ˆæ–°å¢ï¼‰==========
    aiPrelimIgnore      Boolean?  @map("ai_prelim_ignore")
    aiPrelimReason      String?   @map("ai_prelim_reason") @db.Text
    aiPrelimValue       Int?      @map("ai_prelim_value")      // 1-5 åˆ†
    aiPrelimSummary     String?   @map("ai_prelim_summary") @db.Text
    aiPrelimLanguage    String?   @map("ai_prelim_language")   // 'zh', 'en', 'other'
    aiPrelimAnalyzedAt  DateTime? @map("ai_prelim_analyzed_at")

    // é˜Ÿåˆ—çŠ¶æ€
    aiPrelimStatus      String?   @map("ai_prelim_status")     // 'pending', 'passed', 'rejected'
  }
  ```

- [ ] **1.2 åˆ›å»ºè¿ç§»**

  ```bash
  # ç”Ÿæˆ Prisma Client
  npm run db:generate

  # æ¨é€åˆ°å¼€å‘æ•°æ®åº“
  npm run db:push

  # ç”Ÿäº§ç¯å¢ƒè¿ç§»
  npm run db:migrate
  ```

- [ ] **1.3 éªŒè¯æµ‹è¯•**

  ```typescript
  // scripts/test-preliminary-schema.ts
  import { db } from '@/lib/db';

  async function testSchema() {
    // æµ‹è¯•å†™å…¥åˆè¯„æ•°æ®
    const testEntry = await db.entry.update({
      where: { id: 'test-entry-id' },
      data: {
        aiPrelimIgnore: false,
        aiPrelimReason: 'é«˜è´¨é‡æŠ€æœ¯æ–‡ç« ',
        aiPrelimValue: 5,
        aiPrelimSummary: 'æ·±å…¥æ¢è®¨XXXæŠ€æœ¯',
        aiPrelimLanguage: 'zh',
        aiPrelimStatus: 'passed',
        aiPrelimAnalyzedAt: new Date(),
      },
    });

    console.log('Schema æµ‹è¯•é€šè¿‡:', testEntry);
  }
  ```

#### äº¤ä»˜ç‰©

- [ ] æ›´æ–°çš„ `schema.prisma`
- [ ] æ•°æ®åº“è¿ç§»è„šæœ¬
- [ ] Schema éªŒè¯æµ‹è¯•

#### éªŒæ”¶æ ‡å‡†

- âœ… Prisma Client æˆåŠŸç”Ÿæˆ
- [ ] æ•°æ®åº“è¿ç§»æˆåŠŸ
- [ ] å¯ä»¥è¯»å†™åˆè¯„å­—æ®µ

---

### Phase 2: åˆè¯„å…³å¡ç³»ç»Ÿ

**æ—¶é—´**: 2-3 å¤©

**ç›®æ ‡**: å®ç°åˆè¯„è¿‡æ»¤åŠŸèƒ½ï¼ŒèŠ‚çœ 40% æ·±åº¦åˆ†ææˆæœ¬

#### 2.1 PreliminaryEvaluator å®ç°

**æ–‡ä»¶**: `lib/ai/preliminary-evaluator.ts`

```typescript
/**
 * åˆè¯„è¯„ä¼°å™¨
 *
 * ä½¿ç”¨è½»é‡çº§æ¨¡å‹å¿«é€Ÿè¯„ä¼°æ–‡ç« ä»·å€¼
 */

import { getDefaultAIService } from '@/lib/ai/client';

export interface PreliminaryEvaluation {
  ignore: boolean;           // æ˜¯å¦å¿½ç•¥
  reason: string;            // ä¸»é¢˜æè¿°
  value: number;             // ä»·å€¼è¯„åˆ† 1-5
  summary: string;           // ä¸€å¥è¯æ€»ç»“ï¼ˆ50å­—å†…ï¼‰
  language: string;          // è¯­è¨€ç±»å‹
}

export interface PreliminaryEvaluatorConfig {
  chineseModel: string;      // ä¸­æ–‡æ¨¡å‹
  englishModel: string;      // è‹±æ–‡æ¨¡å‹
  otherModel: string;        // å…¶ä»–è¯­è¨€æ¨¡å‹
  minValue: number;          // æœ€ä½ä»·å€¼åˆ†æ•°ï¼ˆé»˜è®¤3ï¼‰
}

export class PreliminaryEvaluator {
  constructor(
    private config: PreliminaryEvaluatorConfig
  ) {}

  /**
   * è¯„ä¼°æ–‡ç« 
   */
  async evaluate(entry: {
    title: string;
    content: string;
    url?: string;
  }): Promise<PreliminaryEvaluation> {

    // 1. è¯­è¨€æ£€æµ‹
    const language = await this.detectLanguage(entry.content);

    // 2. é€‰æ‹©å¯¹åº”æ¨¡å‹
    const model = this.selectModel(language);

    // 3. æ„å»ºæç¤ºè¯
    const prompt = this.buildPrompt(entry, language);

    // 4. è°ƒç”¨ AI è¿›è¡Œåˆè¯„
    const aiService = getDefaultAIService();
    const result = await aiService.analyzeArticle(
      entry.content.slice(0, 2000), // åªåˆ†æå‰ 2000 å­—ç¬¦
      {
        summary: true,
        category: true,
        importance: true,
      }
    );

    // 5. è§£æç»“æœ
    const value = Math.round((result.importanceScore || 0) * 5);

    return {
      ignore: value < this.config.minValue,
      reason: result.category || 'æœªåˆ†ç±»',
      value,
      summary: result.summary?.slice(0, 50) || '',
      language,
    };
  }

  /**
   * è¯­è¨€æ£€æµ‹
   */
  private async detectLanguage(content: string): Promise<string> {
    // ç®€å•æ£€æµ‹ï¼šä¸­æ–‡å­—ç¬¦æ¯”ä¾‹
    const chineseChars = content.match(/[\u4e00-\u9fa5]/g);
    const chineseRatio = chineseChars
      ? chineseChars.length / content.length
      : 0;

    if (chineseRatio > 0.3) return 'zh';
    if (/[a-zA-Z]/.test(content)) return 'en';
    return 'other';
  }

  /**
   * é€‰æ‹©æ¨¡å‹
   */
  private selectModel(language: string): string {
    switch (language) {
      case 'zh': return this.config.chineseModel;
      case 'en': return this.config.englishModel;
      default: return this.config.otherModel;
    }
  }

  /**
   * æ„å»ºæç¤ºè¯
   */
  private buildPrompt(entry: any, language: string): string {
    const langPrompt = language === 'zh'
      ? 'è¯·ç”¨ä¸­æ–‡å›ç­”'
      : 'Please answer in English';

    return `
${langPrompt}ã€‚ä½ æ˜¯æ–‡ç« åˆè¯„ä¸“å®¶ï¼Œè¯·å¿«é€Ÿè¯„ä¼°ä»¥ä¸‹æ–‡ç« ã€‚

æ ‡é¢˜ï¼š${entry.title}
å†…å®¹ï¼š${entry.content.slice(0, 1000)}...

è¯·è¿”å›ï¼š
1. æ˜¯å¦å€¼å¾—æ·±å…¥é˜…è¯»ï¼ˆå¿½ç•¥å¹¿å‘Šã€ä½è´¨å†…å®¹ï¼‰
2. ä¸»é¢˜æè¿°ï¼ˆä¸€å¥è¯ï¼‰
3. ä»·å€¼è¯„åˆ†ï¼ˆ1-5åˆ†ï¼‰
4. ä¸€å¥è¯æ€»ç»“ï¼ˆ50å­—å†…ï¼‰
    `;
  }
}

/**
 * é»˜è®¤åˆè¯„è¯„ä¼°å™¨
 */
export function createPreliminaryEvaluator(): PreliminaryEvaluator {
  return new PreliminaryEvaluator({
    chineseModel: process.env.PRELIMINARY_MODEL_ZH || 'deepseek-chat',
    englishModel: process.env.PRELIMINARY_MODEL_EN || 'gemini-1.5-flash',
    otherModel: process.env.PRELIMINARY_MODEL_OTHER || 'gpt-4o-mini',
    minValue: parseInt(process.env.PRELIMINARY_MIN_VALUE || '3'),
  });
}
```

#### 2.2 ModelSelector å®ç°

**æ–‡ä»¶**: `lib/ai/model-selector.ts`

```typescript
/**
 * æ¨¡å‹é€‰æ‹©å™¨
 *
 * æ ¹æ®è¯­è¨€å’Œé˜¶æ®µé€‰æ‹©æœ€ä¼˜æ¨¡å‹
 */

export interface ModelConfig {
  chinese: {
    preliminary: string;  // åˆè¯„æ¨¡å‹
    analysis: string;     // åˆ†ææ¨¡å‹
    reflection: string;   // åæ€æ¨¡å‹
  };
  english: {
    preliminary: string;
    analysis: string;
    reflection: string;
  };
  other: {
    preliminary: string;
    analysis: string;
    reflection: string;
  };
}

export type AnalysisStage = 'preliminary' | 'analysis' | 'reflection';
export type LanguageType = 'chinese' | 'english' | 'other';

export class ModelSelector {
  constructor(private config: ModelConfig) {}

  /**
   * é€‰æ‹©æ¨¡å‹
   */
  selectModel(
    language: string,
    stage: AnalysisStage
  ): string {
    const langKey = this.getLangKey(language);
    return this.config[langKey][stage];
  }

  /**
   * è·å–è¯­è¨€é”®
   */
  private getLangKey(language: string): LanguageType {
    if (language.startsWith('zh')) return 'chinese';
    if (language.startsWith('en')) return 'english';
    return 'other';
  }

  /**
   * è·å–æ‰€æœ‰é…ç½®
   */
  getConfig(): ModelConfig {
    return { ...this.config };
  }
}

/**
 * é»˜è®¤æ¨¡å‹é€‰æ‹©å™¨
 */
export function createModelSelector(): ModelSelector {
  return new ModelSelector({
    chinese: {
      preliminary: process.env.PRELIMINARY_MODEL_ZH || 'deepseek-chat',
      analysis: process.env.ANALYSIS_MODEL_ZH || 'deepseek-chat',
      reflection: process.env.REFLECTION_MODEL_ZH || 'deepseek-chat',
    },
    english: {
      preliminary: process.env.PRELIMINARY_MODEL_EN || 'gemini-1.5-flash',
      analysis: process.env.ANALYSIS_MODEL_EN || 'gemini-1.5-pro',
      reflection: process.env.REFLECTION_MODEL_EN || 'gpt-4o',
    },
    other: {
      preliminary: process.env.PRELIMINARY_MODEL_OTHER || 'gpt-4o-mini',
      analysis: process.env.ANALYSIS_MODEL_OTHER || 'gpt-4o',
      reflection: process.env.REFLECTION_MODEL_OTHER || 'gpt-4o',
    },
  });
}
```

#### 2.3 åˆè¯„é˜Ÿåˆ—å¤„ç†å™¨

**æ–‡ä»¶**: `lib/queue/preliminary-processor.ts`

```typescript
/**
 * åˆè¯„é˜Ÿåˆ—å¤„ç†å™¨
 *
 * ä½¿ç”¨ BullMQ å¤„ç†æ–‡ç« åˆè¯„ä»»åŠ¡
 */

import { Queue, Worker, Job } from 'bullmq';
import { db } from '@/lib/db';
import { createPreliminaryEvaluator } from '@/lib/ai/preliminary-evaluator';

const REDIS_CONFIG = {
  host: process.env.REDIS_HOST || 'localhost',
  port: parseInt(process.env.REDIS_PORT || '6379'),
  password: process.env.REDIS_PASSWORD,
};

// =====================================================
// ä»»åŠ¡æ•°æ®ç±»å‹
// =====================================================

export interface PreliminaryJobData {
  entryId: string;
  priority?: number;
}

// =====================================================
// é˜Ÿåˆ—å®šä¹‰
// =====================================================

export const preliminaryQueue = new Queue<PreliminaryJobData>('preliminary-analysis', {
  connection: REDIS_CONFIG,
  defaultJobOptions: {
    attempts: 2,
    backoff: {
      type: 'exponential',
      delay: 1000,
    },
    removeOnComplete: {
      age: 3 * 24 * 3600, // 3å¤©ååˆ é™¤
      count: 500,
    },
  },
});

// =====================================================
// é˜Ÿåˆ—å¤„ç†å™¨
// =====================================================

export function createPreliminaryWorker(): Worker<PreliminaryJobData> {
  return new Worker<PreliminaryJobData>(
    'preliminary-analysis',
    async (job: Job<PreliminaryJobData>) => {
      const { entryId } = job.data;

      job.updateProgress(10);

      // 1. è·å–æ–‡ç« 
      const entry = await db.entry.findUnique({
        where: { id: entryId },
      });

      if (!entry) {
        throw new Error(`æ–‡ç«  ${entryId} ä¸å­˜åœ¨`);
      }

      job.updateProgress(30);

      // 2. æ‰§è¡Œåˆè¯„
      const evaluator = createPreliminaryEvaluator();
      const evaluation = await evaluator.evaluate({
        title: entry.title,
        content: entry.content || '',
        url: entry.url,
      });

      job.updateProgress(70);

      // 3. æ›´æ–°æ•°æ®åº“
      await db.entry.update({
        where: { id: entryId },
        data: {
          aiPrelimIgnore: evaluation.ignore,
          aiPrelimReason: evaluation.reason,
          aiPrelimValue: evaluation.value,
          aiPrelimSummary: evaluation.summary,
          aiPrelimLanguage: evaluation.language,
          aiPrelimStatus: evaluation.ignore ? 'rejected' : 'passed',
          aiPrelimAnalyzedAt: new Date(),
        },
      });

      job.updateProgress(90);

      // 4. å¦‚æœé€šè¿‡åˆè¯„ï¼Œæ·»åŠ åˆ°æ·±åº¦åˆ†æé˜Ÿåˆ—
      if (!evaluation.ignore) {
        const { addDeepAnalysisJob } = await import('@/lib/queue/deep-analysis-processor');
        await addDeepAnalysisJob({ entryId, priority: job.data.priority || 5 });
      }

      job.updateProgress(100);

      return {
        success: true,
        evaluation,
        queuedForDeepAnalysis: !evaluation.ignore,
      };
    },
    {
      connection: REDIS_CONFIG,
      concurrency: 5, // å¹¶å‘å¤„ç†5ä¸ªä»»åŠ¡
    }
  );
}

// =====================================================
// é˜Ÿåˆ—æ“ä½œå‡½æ•°
// =====================================================

/**
 * æ·»åŠ åˆè¯„ä»»åŠ¡
 */
export async function addPreliminaryJob(data: PreliminaryJobData): Promise<string> {
  const job = await preliminaryQueue.add('evaluate', data, {
    priority: data.priority || 5,
  });

  return job.id!;
}

/**
 * æ‰¹é‡æ·»åŠ åˆè¯„ä»»åŠ¡
 */
export async function addPreliminaryJobsBatch(
  jobs: PreliminaryJobData[]
): Promise<string[]> {
  const jobPromises = jobs.map(data => addPreliminaryJob(data));
  return Promise.all(jobPromises);
}
```

#### 2.4 API è·¯ç”±

**æ–‡ä»¶**: `server/api/preliminary.ts` (æ–°å»º)

```typescript
/**
 * åˆè¯„ç›¸å…³ API è·¯ç”±
 */

import { createTRPCRouter, protectedProcedure } from '@/server/trpc/init';
import { addPreliminaryJob } from '@/lib/queue/preliminary-processor';
import { db } from '@/lib/db';
import { z } from 'zod';

export const preliminaryRouter = createTRPCRouter({
  /**
   * è§¦å‘åˆè¯„
   */
  trigger: protectedProcedure
    .input(z.object({
      entryId: z.string(),
      priority: z.number().min(1).max(10).optional(),
    }))
    .mutation(async ({ input }) => {
      // æ£€æŸ¥æ˜¯å¦å·²åˆè¯„
      const entry = await db.entry.findUnique({
        where: { id: input.entryId },
        select: { aiPrelimStatus: true },
      });

      if (entry?.aiPrelimStatus) {
        return {
          status: 'already_evaluated',
          message: 'æ–‡ç« å·²åˆè¯„',
        };
      }

      // æ·»åŠ åˆ°åˆè¯„é˜Ÿåˆ—
      const jobId = await addPreliminaryJob({
        entryId: input.entryId,
        priority: input.priority || 5,
      });

      return {
        status: 'queued',
        jobId,
      };
    }),

  /**
   * æ‰¹é‡è§¦å‘åˆè¯„
   */
  triggerBatch: protectedProcedure
    .input(z.object({
      entryIds: z.array(z.string()),
      priority: z.number().min(1).max(10).optional(),
    }))
    .mutation(async ({ input }) => {
      const jobs = await addPreliminaryJobsBatch(
        input.entryIds.map(entryId => ({
          entryId,
          priority: input.priority || 5,
        }))
      );

      return {
        status: 'queued',
        count: jobs.length,
        jobIds: jobs,
      };
    }),

  /**
   * è·å–åˆè¯„ç»“æœ
   */
  getResult: protectedProcedure
    .input(z.object({
      entryId: z.string(),
    }))
    .query(async ({ input }) => {
      const entry = await db.entry.findUnique({
        where: { id: input.entryId },
        select: {
          id: true,
          aiPrelimIgnore: true,
          aiPrelimReason: true,
          aiPrelimValue: true,
          aiPrelimSummary: true,
          aiPrelimLanguage: true,
          aiPrelimStatus: true,
          aiPrelimAnalyzedAt: true,
        },
      });

      if (!entry) {
        throw new Error('æ–‡ç« ä¸å­˜åœ¨');
      }

      return entry;
    }),
});
```

#### 2.5 æµ‹è¯•è„šæœ¬

**æ–‡ä»¶**: `scripts/test-preliminary.ts`

```typescript
/**
 * åˆè¯„åŠŸèƒ½æµ‹è¯•è„šæœ¬
 */

import { addPreliminaryJob } from '@/lib/queue/preliminary-processor';
import { createPreliminaryEvaluator } from '@/lib/ai/preliminary-evaluator';
import { db } from '@/lib/db';

async function testPreliminary() {
  console.log('ğŸ§ª æµ‹è¯•åˆè¯„åŠŸèƒ½\n');

  // 1. è·å–æµ‹è¯•æ–‡ç« 
  const entries = await db.entry.findMany({
    take: 5,
    where: {
      content: { not: null },
      aiPrelimStatus: null,
    },
  });

  console.log(`æ‰¾åˆ° ${entries.length} ç¯‡æœªåˆè¯„æ–‡ç« \n`);

  // 2. æµ‹è¯•åˆè¯„å™¨
  const evaluator = createPreliminaryEvaluator();

  for (const entry of entries) {
    console.log(`\nğŸ“„ æ–‡ç« : ${entry.title}`);

    const evaluation = await evaluator.evaluate({
      title: entry.title,
      content: entry.content || '',
      url: entry.url,
    });

    console.log('  è¯­è¨€:', evaluation.language);
    console.log('  è¯„åˆ†:', evaluation.value);
    console.log('  ä¸»é¢˜:', evaluation.reason);
    console.log('  æ€»ç»“:', evaluation.summary);
    console.log('  æ˜¯å¦å¿½ç•¥:', evaluation.ignore ? 'æ˜¯' : 'å¦');

    // 3. æ·»åŠ åˆ°é˜Ÿåˆ—
    const jobId = await addPreliminaryJob({ entryId: entry.id });
    console.log('  é˜Ÿåˆ—ä»»åŠ¡ID:', jobId);
  }

  console.log('\nâœ… æµ‹è¯•å®Œæˆ');
}

testPreliminary().catch(console.error);
```

#### äº¤ä»˜ç‰©

- [ ] `lib/ai/preliminary-evaluator.ts`
- [ ] `lib/ai/model-selector.ts`
- [ ] `lib/queue/preliminary-processor.ts`
- [ ] `server/api/preliminary.ts`
- [ ] `scripts/test-preliminary.ts`
- [ ] å•å…ƒæµ‹è¯•è¦†ç›– >80%

#### éªŒæ”¶æ ‡å‡†

- [ ] åˆè¯„åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] è¿‡æ»¤ç‡ > 30%
- [ ] é˜Ÿåˆ—å¤„ç†ç¨³å®š
- [ ] API å“åº”æ—¶é—´ < 500ms

---

### Phase 3: è¯­è¨€åˆ†æ”¯ä¼˜åŒ–

**æ—¶é—´**: 1-2 å¤©

**ç›®æ ‡**: æ ¹æ®æ–‡ç« è¯­è¨€é€‰æ‹©æœ€ä¼˜æ¨¡å‹ï¼Œæå‡å‡†ç¡®ç‡ 15%

#### ä»»åŠ¡æ¸…å•

- [ ] **3.1 å¢å¼ºè¯­è¨€æ£€æµ‹**

  **æ–‡ä»¶**: `lib/ai/language-detector.ts`

  ```typescript
  /**
   * è¯­è¨€æ£€æµ‹å·¥å…·
   */

  export interface LanguageDetectionResult {
    language: string;      // 'zh', 'en', 'ja', 'ko', etc.
    confidence: number;    // 0-1
    script?: string;       // 'hanzi', 'latin', 'arabic', etc.
  }

  export class LanguageDetector {
    /**
     * æ£€æµ‹è¯­è¨€
     */
    async detect(text: string): Promise<LanguageDetectionResult> {
      // 1. åŸºäº Unicode èŒƒå›´çš„å¿«é€Ÿæ£€æµ‹
      const script = this.detectScript(text);

      // 2. åŸºäº n-gram çš„ç»Ÿè®¡æ£€æµ‹
      const language = this.detectByNGram(text, script);

      // 3. è®¡ç®—ç½®ä¿¡åº¦
      const confidence = this.calculateConfidence(text, language);

      return { language, confidence, script };
    }

    private detectScript(text: string): string {
      // æ£€æµ‹æ±‰å­—
      if (/[\u4e00-\u9fa5]/.test(text)) return 'hanzi';
      // æ£€æµ‹æ—¥æ–‡å‡å
      if (/[\u3040-\u309f\u30a0-\u30ff]/.test(text)) return 'kana';
      // æ£€æµ‹éŸ©æ–‡
      if (/[\uac00-\ud7af]/.test(text)) return 'hangul';
      // æ£€æµ‹é˜¿æ‹‰ä¼¯æ–‡
      if (/[\u0600-\u06ff]/.test(text)) return 'arabic';
      // æ£€æµ‹è¥¿é‡Œå°”å­—æ¯
      if (/[\u0400-\u04ff]/.test(text)) return 'cyrillic';

      return 'latin';
    }

    private detectByNGram(text: string, script: string): string {
      // æ ¹æ®å­—ç¬¦ç³»ç»Ÿè¿”å›æœ€å¯èƒ½çš„è¯­è¨€
      switch (script) {
        case 'hanzi': return 'zh';
        case 'kana': return 'ja';
        case 'hangul': return 'ko';
        case 'arabic': return 'ar';
        case 'cyrillic': return 'ru';
        default:
          // æ‹‰ä¸å­—æ¯ç³»ç»Ÿéœ€è¦è¿›ä¸€æ­¥åŒºåˆ†
          return this.detectLatinLanguage(text);
      }
    }

    private detectLatinLanguage(text: string): string {
      const lowerText = text.toLowerCase();

      // åŸºäºå¸¸è§è¯çš„ç‰¹å¾æ£€æµ‹
      const features = {
        en: /\b(the|and|is|in|at|of|to|a)\b/g,
        es: /\b(el|la|de|que|y|a|en|un)\b/g,
        fr: /\b(le|la|de|et|Ã |un|en|une)\b/g,
        de: /\b(der|die|das|und|in|den|von|zu)\b/g,
        pt: /\b(o|a|de|e|em|um|para)\b/g,
      };

      let maxCount = 0;
      let detectedLang = 'en';

      for (const [lang, pattern] of Object.entries(features)) {
        const matches = lowerText.match(pattern);
        const count = matches ? matches.length : 0;

        if (count > maxCount) {
          maxCount = count;
          detectedLang = lang;
        }
      }

      return detectedLang;
    }

    private calculateConfidence(text: string, language: string): number {
      // ç®€åŒ–çš„ç½®ä¿¡åº¦è®¡ç®—
      const length = text.length;
      if (length < 50) return 0.5;
      if (length < 200) return 0.7;
      return 0.9;
    }
  }

  export const languageDetector = new LanguageDetector();
  ```

- [ ] **3.2 æ¨¡å‹é…ç½®ç®¡ç†**

  **æ–‡ä»¶**: `lib/ai/model-config.ts`

  ```typescript
  /**
   * æ¨¡å‹é…ç½®ç®¡ç†
   */

  export interface ModelTierConfig {
    provider: string;           // 'openai', 'anthropic', 'deepseek', 'gemini'
    model: string;              // æ¨¡å‹åç§°
    maxTokens: number;          // æœ€å¤§ token
    costPer1kTokens: number;    // æ¯ 1k token æˆæœ¬ï¼ˆç¾å…ƒï¼‰
  }

  export const MODEL_TIERS: Record<string, ModelTierConfig> = {
    // OpenAI æ¨¡å‹
    'gpt-4o': {
      provider: 'openai',
      model: 'gpt-4o',
      maxTokens: 128000,
      costPer1kTokens: 0.005,
    },
    'gpt-4o-mini': {
      provider: 'openai',
      model: 'gpt-4o-mini',
      maxTokens: 128000,
      costPer1kTokens: 0.00015,
    },

    // Anthropic æ¨¡å‹
    'claude-3-5-sonnet': {
      provider: 'anthropic',
      model: 'claude-3-5-sonnet-20241022',
      maxTokens: 200000,
      costPer1kTokens: 0.003,
    },
    'claude-3-haiku': {
      provider: 'anthropic',
      model: 'claude-3-haiku-20240307',
      maxTokens: 200000,
      costPer1kTokens: 0.00025,
    },

    // DeepSeek æ¨¡å‹
    'deepseek-chat': {
      provider: 'deepseek',
      model: 'deepseek-chat',
      maxTokens: 128000,
      costPer1kTokens: 0.00014,
    },
    'deepseek-coder': {
      provider: 'deepseek',
      model: 'deepseek-coder',
      maxTokens: 128000,
      costPer1kTokens: 0.00014,
    },

    // Gemini æ¨¡å‹
    'gemini-1.5-flash': {
      provider: 'gemini',
      model: 'gemini-1.5-flash',
      maxTokens: 1000000,
      costPer1kTokens: 0.000075,
    },
    'gemini-1.5-pro': {
      provider: 'gemini',
      model: 'gemini-1.5-pro',
      maxTokens: 2000000,
      costPer1kTokens: 0.0035,
    },
  };

  /**
   * è·å–æ¨¡å‹é…ç½®
   */
  export function getModelConfig(modelKey: string): ModelTierConfig {
    return MODEL_TIERS[modelKey] || MODEL_TIERS['gpt-4o-mini'];
  }

  /**
   * è®¡ç®—æˆæœ¬
   */
  export function calculateCost(
    modelKey: string,
    inputTokens: number,
    outputTokens: number
  ): number {
    const config = getModelConfig(modelKey);
    const totalTokens = inputTokens + outputTokens;
    return (totalTokens / 1000) * config.costPer1kTokens;
  }
  ```

- [ ] **3.3 é›†æˆåˆ°ç°æœ‰æµç¨‹**

  æ›´æ–° `lib/queue/deep-analysis-processor.ts`ï¼š

  ```typescript
  // åœ¨å¤„ç†å™¨ä¸­æ·»åŠ è¯­è¨€æ£€æµ‹
  import { languageDetector } from '@/lib/ai/language-detector';
  import { createModelSelector } from '@/lib/ai/model-selector';

  // åœ¨å¤„ç†æµç¨‹ä¸­
  const languageResult = await languageDetector.detect(entry.content || '');
  const modelSelector = createModelSelector();

  const analysisModel = modelSelector.selectModel(
    languageResult.language,
    'analysis'
  );
  ```

#### äº¤ä»˜ç‰©

- [ ] `lib/ai/language-detector.ts`
- [ ] `lib/ai/model-config.ts`
- [ ] æ›´æ–°çš„ `deep-analysis-processor.ts`
- [ ] è¯­è¨€æ£€æµ‹æµ‹è¯•

#### éªŒæ”¶æ ‡å‡†

- [ ] è¯­è¨€æ£€æµ‹å‡†ç¡®ç‡ > 95%
- [ ] æ¨¡å‹é€‰æ‹©é€»è¾‘æ­£ç¡®
- [ ] æˆæœ¬è®¡ç®—å‡†ç¡®
- [ ] ä¸­æ–‡æ–‡ç« å‡†ç¡®ç‡ +7%
- [ ] è‹±æ–‡æ–‡ç« å‡†ç¡®ç‡ +15%

---

### Phase 4: çŸ­æ–‡ä¼˜åŒ–è·¯å¾„

**æ—¶é—´**: 1-2 å¤©

**ç›®æ ‡**: çŸ­æ–‡ç« ï¼ˆâ‰¤6000å­—ç¬¦ï¼‰ç›´æ¥åˆ†æï¼Œå¤„ç†é€Ÿåº¦æå‡ 50%

#### ä»»åŠ¡æ¸…å•

- [ ] **4.1 SmartAnalyzer å®ç°**

  **æ–‡ä»¶**: `lib/ai/smart-analyzer.ts`

  ```typescript
  /**
   * æ™ºèƒ½åˆ†æå™¨
   *
   * æ ¹æ®æ–‡ç« é•¿åº¦é€‰æ‹©æœ€ä¼˜åˆ†æç­–ç•¥
   */

  import { SegmentedAnalyzer } from '@/lib/ai/analysis/segmented-analyzer';
  import type { LLMService } from '@/lib/ai/analysis/types';
  import type { ArticleAnalysisResult } from '@/lib/ai/analysis/types';

  export interface SmartAnalyzerConfig {
    shortThreshold: number;   // çŸ­æ–‡é˜ˆå€¼ï¼ˆå­—ç¬¦æ•°ï¼‰
    segmentThreshold: number; // åˆ†æ®µé˜ˆå€¼ï¼ˆå­—ç¬¦æ•°ï¼‰
  }

  export class SmartAnalyzer {
    constructor(
      private llm: LLMService,
      private config: SmartAnalyzerConfig = {
        shortThreshold: 6000,
        segmentThreshold: 12000,
      }
    ) {}

    /**
     * æ™ºèƒ½åˆ†æ
     */
    async analyze(
      content: string,
      metadata?: {
        title?: string;
        author?: string;
        url?: string;
      }
    ): Promise<ArticleAnalysisResult> {

      const contentLength = content.length;

      // è·¯å¾„ 1: çŸ­æ–‡ç›´æ¥åˆ†æ
      if (contentLength <= this.config.shortThreshold) {
        return this.analyzeShort(content, metadata);
      }

      // è·¯å¾„ 2: ä¸­ç­‰æ–‡ç« åˆ†æ®µåˆ†æ
      if (contentLength <= this.config.segmentThreshold) {
        return this.analyzeSegmented(content, metadata);
      }

      // è·¯å¾„ 3: é•¿æ–‡ç« åˆ†æ®µåˆ†æ + åˆå¹¶
      return this.analyzeLong(content, metadata);
    }

    /**
     * çŸ­æ–‡ç›´æ¥åˆ†æ
     */
    private async analyzeShort(
      content: string,
      metadata?: any
    ): Promise<ArticleAnalysisResult> {

      const prompt = this.buildDirectPrompt(content, metadata);

      const result = await this.llm.chat([
        {
          role: 'system',
          content: this.getSystemPrompt(),
        },
        {
          role: 'user',
          content: prompt,
        },
      ]);

      return this.parseResult(result.content);
    }

    /**
     * åˆ†æ®µåˆ†æ
     */
    private async analyzeSegmented(
      content: string,
      metadata?: any
    ): Promise<ArticleAnalysisResult> {

      const segmentedAnalyzer = new SegmentedAnalyzer(this.llm);
      return segmentedAnalyzer.analyze(content, metadata);
    }

    /**
     * é•¿æ–‡åˆ†æï¼ˆå¸¦åˆå¹¶ï¼‰
     */
    private async analyzeLong(
      content: string,
      metadata?: any
    ): Promise<ArticleAnalysisResult> {

      // åˆ†æ®µ
      const segments = this.splitIntoSegments(content, 3000);

      // å¹¶è¡Œåˆ†æ
      const results = await Promise.all(
        segments.map(segment => this.analyzeShort(segment, metadata))
      );

      // åˆå¹¶ç»“æœ
      return this.mergeResults(results);
    }

    /**
     * æ„å»ºç›´æ¥åˆ†ææç¤ºè¯
     */
    private buildDirectPrompt(content: string, metadata?: any): string {
      return `
è¯·åˆ†æä»¥ä¸‹æ–‡ç« ï¼š

æ ‡é¢˜ï¼š${metadata?.title || 'æœªçŸ¥'}
ä½œè€…ï¼š${metadata?.author || 'æœªçŸ¥'}

${content}

è¯·è¿”å› JSON æ ¼å¼ï¼š
{
  "oneLineSummary": "ä¸€å¥è¯æ€»ç»“",
  "summary": "è¯¦ç»†æ‘˜è¦",
  "mainPoints": ["è¦ç‚¹1", "è¦ç‚¹2"],
  "tags": ["æ ‡ç­¾1", "æ ‡ç­¾2"],
  "domain": "é¢†åŸŸ",
  "aiScore": 8
}
      `;
    }

    /**
     * åˆ†å‰²æˆæ®µè½
     */
    private splitIntoSegments(content: string, maxLength: number): string[] {
      const segments: string[] = [];
      let current = '';

      const paragraphs = content.split(/\n\n+/);

      for (const para of paragraphs) {
        if (current.length + para.length > maxLength && current.length > 0) {
          segments.push(current.trim());
          current = para;
        } else {
          current += '\n\n' + para;
        }
      }

      if (current.length > 0) {
        segments.push(current.trim());
      }

      return segments;
    }

    /**
     * åˆå¹¶ç»“æœ
     */
    private mergeResults(results: ArticleAnalysisResult[]): ArticleAnalysisResult {
      // æ”¶é›†æ‰€æœ‰è¦ç‚¹
      const allPoints = results.flatMap(r => r.mainPoints || []);

      // å»é‡ï¼ˆç›¸ä¼¼åº¦æ£€æµ‹ï¼‰
      const uniquePoints = this.deduplicatePoints(allPoints);

      // åˆå¹¶æ ‡ç­¾
      const allTags = results.flatMap(r => r.tags || []);
      const uniqueTags = [...new Set(allTags)];

      // å¹³å‡è¯„åˆ†
      const avgScore = results.reduce((sum, r) => sum + (r.aiScore || 0), 0) / results.length;

      return {
        oneLineSummary: results[0]?.oneLineSummary || '',
        summary: results.map(r => r.summary).join('\n\n'),
        mainPoints: uniquePoints,
        tags: uniqueTags,
        domain: results[0]?.domain,
        aiScore: Math.round(avgScore),
        analysisModel: 'smart-analyzer',
      };
    }

    /**
     * è¦ç‚¹å»é‡
     */
    private deduplicatePoints(points: string[]): string[] {
      // ç®€å•å»é‡ï¼šåŸºäºæ–‡æœ¬ç›¸ä¼¼åº¦
      const unique: string[] = [];

      for (const point of points) {
        const isDuplicate = unique.some(existing =>
          this.calculateSimilarity(existing, point) > 0.8
        );

        if (!isDuplicate) {
          unique.push(point);
        }
      }

      return unique;
    }

    /**
     * è®¡ç®—ç›¸ä¼¼åº¦ï¼ˆç®€å•çš„è¯è¢‹æ¨¡å‹ï¼‰
     */
    private calculateSimilarity(a: string, b: string): number {
      const wordsA = new Set(a.toLowerCase().split(/\s+/));
      const wordsB = new Set(b.toLowerCase().split(/\s+/));

      const intersection = new Set(
        [...wordsA].filter(x => wordsB.has(x))
      );

      const union = new Set([...wordsA, ...wordsB]);

      return intersection.size / union.size;
    }

    /**
     * è·å–ç³»ç»Ÿæç¤ºè¯
     */
    private getSystemPrompt(): string {
      return `ä½ æ˜¯ä¸“ä¸šçš„æ–‡ç« åˆ†æåŠ©æ‰‹ã€‚

è¯·åˆ†ææ–‡ç« å¹¶è¿”å›ï¼š
1. ä¸€å¥è¯æ€»ç»“ï¼ˆ20å­—å†…ï¼‰
2. è¯¦ç»†æ‘˜è¦ï¼ˆ3-5å¥è¯ï¼‰
3. ä¸»è¦è§‚ç‚¹ï¼ˆ3-5ä¸ªï¼ŒæŒ‰é‡è¦æ€§æ’åºï¼‰
4. ç›¸å…³æ ‡ç­¾ï¼ˆ3-5ä¸ªï¼‰
5. æ–‡ç« é¢†åŸŸ
6. è´¨é‡è¯„åˆ†ï¼ˆ1-10åˆ†ï¼‰`;
    }

    /**
     * è§£æç»“æœ
     */
    private parseResult(content: string): ArticleAnalysisResult {
      try {
        // å°è¯•æå– JSON
        const jsonMatch = content.match(/\{[\s\S]*\}/);
        if (jsonMatch) {
          return JSON.parse(jsonMatch[0]);
        }
      } catch {}

      // å¦‚æœè§£æå¤±è´¥ï¼Œè¿”å›é»˜è®¤ç»“æ„
      return {
        oneLineSummary: content.slice(0, 50),
        summary: content,
        mainPoints: [],
        tags: [],
        aiScore: 5,
      };
    }
  }
  ```

- [ ] **4.2 æ€§èƒ½å¯¹æ¯”æµ‹è¯•**

  **æ–‡ä»¶**: `scripts/test-smart-analyzer.ts`

  ```typescript
  /**
   * æ™ºèƒ½åˆ†æå™¨æ€§èƒ½æµ‹è¯•
   */

  import { SmartAnalyzer } from '@/lib/ai/smart-analyzer';
  import { SegmentedAnalyzer } from '@/lib/ai/analysis/segmented-analyzer';
  import { db } from '@/lib/db';

  async function comparePerformance() {
    console.log('ğŸ”¬ æ€§èƒ½å¯¹æ¯”æµ‹è¯•\n');

    // è·å–æµ‹è¯•æ–‡ç« 
    const entries = await db.entry.findMany({
      take: 10,
      where: { content: { not: null } },
    });

    const llm = createMockLLM(); // éœ€è¦å®ç°
    const smartAnalyzer = new SmartAnalyzer(llm);
    const segmentedAnalyzer = new SegmentedAnalyzer(llm);

    const results = {
      short: { count: 0, time: 0 },
      medium: { count: 0, time: 0 },
      long: { count: 0, time: 0 },
    };

    for (const entry of entries) {
      const content = entry.content || '';
      const length = content.length;

      console.log(`\nğŸ“„ ${entry.title} (${length} å­—ç¬¦)`);

      // æµ‹è¯•æ™ºèƒ½åˆ†æå™¨
      const smartStart = Date.now();
      await smartAnalyzer.analyze(content, { title: entry.title });
      const smartTime = Date.now() - smartStart;

      // æµ‹è¯•åˆ†æ®µåˆ†æå™¨
      const segStart = Date.now();
      await segmentedAnalyzer.analyze(content, { title: entry.title });
      const segTime = Date.now() - segStart;

      const category = length < 6000 ? 'short' : length < 12000 ? 'medium' : 'long';
      results[category].count++;
      results[category].time += smartTime;

      console.log(`  æ™ºèƒ½åˆ†æå™¨: ${smartTime}ms`);
      console.log(`  åˆ†æ®µåˆ†æå™¨: ${segTime}ms`);
      console.log(`  æå‡: ${Math.round((1 - smartTime / segTime) * 100)}%`);
    }

    console.log('\nğŸ“Š ç»Ÿè®¡ç»“æœ:');
    console.log(`  çŸ­æ–‡ (${results.short.count}ç¯‡): ${Math.round(results.short.time / results.short.count)}ms å¹³å‡`);
    console.log(`  ä¸­æ–‡ (${results.medium.count}ç¯‡): ${Math.round(results.medium.time / results.medium.count)}ms å¹³å‡`);
    console.log(`  é•¿æ–‡ (${results.long.count}ç¯‡): ${Math.round(results.long.time / results.long.count)}ms å¹³å‡`);
  }

  comparePerformance().catch(console.error);
  ```

#### äº¤ä»˜ç‰©

- [ ] `lib/ai/smart-analyzer.ts`
- [ ] `scripts/test-smart-analyzer.ts`
- [ ] æ€§èƒ½æµ‹è¯•æŠ¥å‘Š

#### éªŒæ”¶æ ‡å‡†

- [ ] çŸ­æ–‡å¤„ç†é€Ÿåº¦æå‡ > 40%
- [ ] åˆ†æè´¨é‡ä¸é™ä½
- [ ] é•¿æ–‡å¤„ç†æ—¶é—´ä¸å¢åŠ 

---

### Phase 5: åé¦ˆæœºåˆ¶ï¼ˆå¯é€‰ï¼‰

**æ—¶é—´**: 2-3 å¤©

**ç›®æ ‡**: çº³å…¥ç”¨æˆ·åé¦ˆï¼ŒæŒç»­ä¼˜åŒ–åˆ†æè´¨é‡

#### ä»»åŠ¡æ¸…å•

- [ ] **5.1 FeedbackEngine å®ç°**

  **æ–‡ä»¶**: `lib/ai/feedback-engine.ts`

  ```typescript
  /**
   * åé¦ˆæ”¹è¿›å¼•æ“
   *
   * æ•´åˆç”¨æˆ·åé¦ˆä¼˜åŒ–åˆ†æç»“æœ
   */

  import { ReflectionEngine } from '@/lib/ai/analysis/reflection-engine';
  import { db } from '@/lib/db';
  import type { LLMService } from '@/lib/ai/analysis/types';
  import type { ArticleAnalysisResult } from '@/lib/ai/analysis/types';

  export interface UserFeedback {
   entryId: string;
   userId: string;
   summaryIssue?: string;       // æ‘˜è¦é—®é¢˜
   tagSuggestions?: string[];    // æ ‡ç­¾å»ºè®®
   rating?: number;              // è¯„åˆ† 1-5
   isHelpful?: boolean;          // æ˜¯å¦æœ‰å¸®åŠ©
   comments?: string;            // å…¶ä»–è¯„è®º
  }

  export class FeedbackEngine {
   constructor(private llm: LLMService) {}

   /**
    * æ ¹æ®åé¦ˆä¼˜åŒ–åˆ†æ
    */
   async improveWithFeedback(
    entryId: string,
    currentAnalysis: ArticleAnalysisResult,
    userFeedback?: UserFeedback
   ): Promise<ArticleAnalysisResult> {

    let improvedAnalysis = currentAnalysis;

    // 1. è‡ªæˆ‘åæ€
    const entry = await db.entry.findUnique({
      where: { id: entryId },
    });

    if (!entry) {
      throw new Error('æ–‡ç« ä¸å­˜åœ¨');
    }

    const reflection = new ReflectionEngine(this.llm);
    improvedAnalysis = await reflection.refine(
      entry.content || '',
      improvedAnalysis,
      1 // åæ€è½®æ•°
    );

    // 2. åº”ç”¨ç”¨æˆ·åé¦ˆ
    if (userFeedback) {
      improvedAnalysis = await this.applyUserFeedback(
        improvedAnalysis,
        userFeedback
      );

      // ä¿å­˜åé¦ˆ
      await this.saveFeedback(userFeedback);
    }

    return improvedAnalysis;
   }

   /**
    * åº”ç”¨ç”¨æˆ·åé¦ˆ
    */
   private async applyUserFeedback(
    analysis: ArticleAnalysisResult,
    feedback: UserFeedback
   ): Promise<ArticleAnalysisResult> {

    const prompt = `
å½“å‰åˆ†æç»“æœï¼š
${JSON.stringify(analysis, null, 2)}

ç”¨æˆ·åé¦ˆï¼š
- æ‘˜è¦é—®é¢˜ï¼š${feedback.summaryIssue || 'æ— '}
- æ ‡ç­¾å»ºè®®ï¼š${feedback.tagSuggestions?.join(', ') || 'æ— '}
- è¯„åˆ†ï¼š${feedback.rating || 'æ— '}
- æœ‰å¸®åŠ©ï¼š${feedback.isHelpful ? 'æ˜¯' : 'å¦'}
- å…¶ä»–æ„è§ï¼š${feedback.comments || 'æ— '}

è¯·æ ¹æ®ç”¨æˆ·åé¦ˆä¼˜åŒ–åˆ†æç»“æœï¼Œè¿”å› JSON æ ¼å¼ã€‚
    `;

    try {
      const result = await this.llm.chat([
        { role: 'system', content: 'ä½ æ˜¯åˆ†æä¼˜åŒ–åŠ©æ‰‹ã€‚' },
        { role: 'user', content: prompt },
      ]);

      const improved = JSON.parse(result.content);
      return { ...analysis, ...improved };
    } catch {
      return analysis;
    }
   }

   /**
    * ä¿å­˜ç”¨æˆ·åé¦ˆ
    */
   private async saveFeedback(feedback: UserFeedback): Promise<void> {
    // TODO: åˆ›å»º Feedback æ¨¡å‹ä¿å­˜
    console.log('ä¿å­˜åé¦ˆ:', feedback);
   }

   /**
    * è·å–åé¦ˆç»Ÿè®¡
    */
   async getFeedbackStats(entryId: string) {
    // TODO: ç»Ÿè®¡åé¦ˆæ•°æ®
    return {
      total: 0,
      helpful: 0,
      avgRating: 0,
    };
   }
  }
  ```

- [ ] **5.2 å‰ç«¯åé¦ˆç»„ä»¶**

  **æ–‡ä»¶**: `components/ai/AnalysisFeedback.tsx`

  ```tsx
  'use client';

  /**
   * åˆ†æåé¦ˆç»„ä»¶
   */

  import { useState } from 'react';
  import { Button } from '@/components/ui/button';
  import { Textarea } from '@/components/ui/textarea';
  import { api } from '@/trpc/react';

  interface AnalysisFeedbackProps {
    entryId: string;
    currentAnalysis: any;
  }

  export function AnalysisFeedback({
    entryId,
    currentAnalysis,
  }: AnalysisFeedbackProps) {

    const [summaryIssue, setSummaryIssue] = useState('');
    const [tagSuggestions, setTagSuggestions] = useState('');
    const [rating, setRating] = useState<number>();
    const [isHelpful, setIsHelpful] = useState<boolean>();
    const [comments, setComments] = useState('');

    const { mutate: submitFeedback, isLoading } =
      api.analytics.submitFeedback.useMutation();

    const handleSubmit = () => {
      submitFeedback({
        entryId,
        summaryIssue: summaryIssue || undefined,
        tagSuggestions: tagSuggestions.split(',').map(t => t.trim()).filter(Boolean),
        rating,
        isHelpful,
        comments: comments || undefined,
      });
    };

    return (
      <div className="space-y-4 p-4 border rounded-lg">
        <h3 className="font-semibold">åˆ†æåé¦ˆ</h3>

        {/* è¯„åˆ† */}
        <div>
          <label className="text-sm text-muted-foreground">è¯„åˆ†</label>
          <div className="flex gap-2 mt-1">
            {[1, 2, 3, 4, 5].map(score => (
              <button
                key={score}
                onClick={() => setRating(score)}
                className={`w-8 h-8 rounded ${
                  rating === score ? 'bg-primary text-primary-foreground' : 'bg-muted'
                }`}
              >
                {score}
              </button>
            ))}
          </div>
        </div>

        {/* æ˜¯å¦æœ‰å¸®åŠ© */}
        <div>
          <label className="text-sm text-muted-foreground">è¿™ä¸ªåˆ†ææœ‰å¸®åŠ©å—ï¼Ÿ</label>
          <div className="flex gap-2 mt-1">
            <Button
              variant={isHelpful === true ? 'default' : 'outline'}
              size="sm"
              onClick={() => setIsHelpful(true)}
            >
              æœ‰å¸®åŠ©
            </Button>
            <Button
              variant={isHelpful === false ? 'default' : 'outline'}
              size="sm"
              onClick={() => setIsHelpful(false)}
            >
              æ²¡å¸®åŠ©
            </Button>
          </div>
        </div>

        {/* æ‘˜è¦é—®é¢˜ */}
        <div>
          <label className="text-sm text-muted-foreground">æ‘˜è¦æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</label>
          <Textarea
            value={summaryIssue}
            onChange={e => setSummaryIssue(e.target.value)}
            placeholder="ä¾‹å¦‚ï¼šæ‘˜è¦ä¸å¤Ÿå‡†ç¡®ã€é—æ¼äº†é‡è¦è§‚ç‚¹..."
            rows={2}
          />
        </div>

        {/* æ ‡ç­¾å»ºè®® */}
        <div>
          <label className="text-sm text-muted-foreground">æ ‡ç­¾å»ºè®®ï¼ˆé€—å·åˆ†éš”ï¼‰</label>
          <Textarea
            value={tagSuggestions}
            onChange={e => setTagSuggestions(e.target.value)}
            placeholder="ä¾‹å¦‚ï¼šReact, æ€§èƒ½ä¼˜åŒ–, æœ€ä½³å®è·µ"
            rows={2}
          />
        </div>

        {/* å…¶ä»–æ„è§ */}
        <div>
          <label className="text-sm text-muted-foreground">å…¶ä»–æ„è§</label>
          <Textarea
            value={comments}
            onChange={e => setComments(e.target.value)}
            placeholder="ä»»ä½•å…¶ä»–æ„è§æˆ–å»ºè®®..."
            rows={3}
          />
        </div>

        {/* æäº¤æŒ‰é’® */}
        <Button onClick={handleSubmit} disabled={isLoading}>
          {isLoading ? 'æäº¤ä¸­...' : 'æäº¤åé¦ˆ'}
        </Button>
      </div>
    );
  }
  ```

#### äº¤ä»˜ç‰©

- [ ] `lib/ai/feedback-engine.ts`
- [ ] `components/ai/AnalysisFeedback.tsx`
- [ ] åé¦ˆ API è·¯ç”±
- [ ] åé¦ˆæ•°æ®æ¨¡å‹

#### éªŒæ”¶æ ‡å‡†

- [ ] ç”¨æˆ·å¯ä»¥æäº¤åé¦ˆ
- [ ] åé¦ˆå¯ä»¥ä¼˜åŒ–åç»­åˆ†æ
- [ ] A/B æµ‹è¯•æ˜¾ç¤ºæ”¹è¿›æ•ˆæœ

---

### Phase 6: ç›‘æ§å’Œä¼˜åŒ–

**æ—¶é—´**: 1-2 å¤©

**ç›®æ ‡**: å»ºç«‹å®Œæ•´çš„ç›‘æ§ä½“ç³»ï¼ŒæŒç»­ä¼˜åŒ–æ€§èƒ½å’Œæˆæœ¬

#### ä»»åŠ¡æ¸…å•

- [ ] **6.1 æŒ‡æ ‡æ”¶é›†**

  **æ–‡ä»¶**: `lib/ai/metrics.ts`

  ```typescript
  /**
   * AI åˆ†ææŒ‡æ ‡æ”¶é›†
   */

  export interface AnalysisMetrics {
    entryId: string;
    stage: 'preliminary' | 'analysis' | 'reflection';
    model: string;
    language: string;
    contentLength: number;
    processingTime: number;     // æ¯«ç§’
    inputTokens: number;
    outputTokens: number;
    cost: number;               // ç¾å…ƒ
    success: boolean;
    errorMessage?: string;
  }

  export class MetricsCollector {
    private metrics: AnalysisMetrics[] = [];

    /**
     * è®°å½•æŒ‡æ ‡
     */
    record(metric: AnalysisMetrics) {
      this.metrics.push(metric);
    }

    /**
     * è·å–ç»Ÿè®¡
     */
    getStats(timeRange?: { start: Date; end: Date }) {
      let filtered = this.metrics;

      if (timeRange) {
        filtered = filtered.filter(m => {
          // éœ€è¦åœ¨æŒ‡æ ‡ä¸­æ·»åŠ æ—¶é—´æˆ³
          return true;
        });
      }

      return {
        total: filtered.length,
        successRate: filtered.filter(m => m.success).length / filtered.length,
        avgProcessingTime: this.average(filtered, 'processingTime'),
        avgCost: this.average(filtered, 'cost'),
        totalCost: filtered.reduce((sum, m) => sum + m.cost, 0),
        byModel: this.groupBy(filtered, 'model'),
        byLanguage: this.groupBy(filtered, 'language'),
        byStage: this.groupBy(filtered, 'stage'),
      };
    }

    private average(arr: any[], key: string): number {
      if (arr.length === 0) return 0;
      const sum = arr.reduce((s, item) => s + (item[key] || 0), 0);
      return sum / arr.length;
    }

    private groupBy(arr: any[], key: string) {
      return arr.reduce((groups, item) => {
        const k = item[key];
        if (!groups[k]) groups[k] = [];
        groups[k].push(item);
        return groups;
      }, {} as Record<string, any[]>);
    }
  }

  export const metricsCollector = new MetricsCollector();
  ```

- [ ] **6.2 æˆæœ¬åˆ†æ**

  **æ–‡ä»¶**: `scripts/cost-analysis.ts`

  ```typescript
  /**
   * æˆæœ¬åˆ†æè„šæœ¬
   */

  import { metricsCollector } from '@/lib/ai/metrics';
  import { db } from '@/lib/db';

  async function analyzeCosts() {
    const stats = metricsCollector.getStats();

    console.log('ğŸ’° æˆæœ¬åˆ†ææŠ¥å‘Š\n');
    console.log(`æ€»å¤„ç†æ•°: ${stats.total}`);
    console.log(`æˆåŠŸç‡: ${(stats.successRate * 100).toFixed(1)}%`);
    console.log(`æ€»æˆæœ¬: $${stats.totalCost.toFixed(4)}`);
    console.log(`å¹³å‡æˆæœ¬: $${stats.avgCost.toFixed(6)}`);

    console.log('\næŒ‰æ¨¡å‹:');
    for (const [model, metrics] of Object.entries(stats.byModel)) {
      const count = metrics.length;
      const cost = metrics.reduce((sum: number, m: any) => sum + m.cost, 0);
      console.log(`  ${model}: ${count} æ¬¡, $${cost.toFixed(4)}`);
    }

    console.log('\næŒ‰è¯­è¨€:');
    for (const [lang, metrics] of Object.entries(stats.byLanguage)) {
      const count = metrics.length;
      const cost = metrics.reduce((sum: number, m: any) => sum + m.cost, 0);
      console.log(`  ${lang}: ${count} æ¬¡, $${cost.toFixed(4)}`);
    }

    // æˆæœ¬ä¼˜åŒ–å»ºè®®
    console.log('\nğŸ’¡ ä¼˜åŒ–å»ºè®®:');
    const modelCosts = Object.entries(stats.byModel)
      .map(([model, metrics]: [string, any]) => ({
        model,
        cost: metrics.reduce((sum: number, m: any) => sum + m.cost, 0),
      }))
      .sort((a, b) => b.cost - a.cost);

    if (modelCosts.length > 0) {
      console.log(`  æœ€æ˜‚è´µæ¨¡å‹: ${modelCosts[0].model} ($${modelCosts[0].cost.toFixed(4)})`);
      console.log('  å»ºè®®: è€ƒè™‘ä½¿ç”¨æ›´ä¾¿å®œçš„æ¨¡å‹è¿›è¡Œåˆè¯„');
    }
  }

  analyzeCosts().catch(console.error);
  ```

- [ ] **6.3 æ€§èƒ½ç›‘æ§**

  **æ–‡ä»¶**: `lib/ai/monitor.ts`

  ```typescript
  /**
   * æ€§èƒ½ç›‘æ§
   */

  export interface PerformanceAlert {
    type: 'slow_processing' | 'high_cost' | 'low_quality' | 'error_spike';
    severity: 'info' | 'warning' | 'critical';
    message: string;
    data: any;
  }

  export class PerformanceMonitor {
    private alerts: PerformanceAlert[] = [];

    /**
     * æ£€æŸ¥æ€§èƒ½
     */
    check(metrics: AnalysisMetrics[]): PerformanceAlert[] {
      this.alerts = [];

      // æ£€æŸ¥å¤„ç†æ—¶é—´
      const avgTime = this.average(metrics, 'processingTime');
      if (avgTime > 60000) { // è¶…è¿‡ 1 åˆ†é’Ÿ
        this.alerts.push({
          type: 'slow_processing',
          severity: 'warning',
          message: `å¹³å‡å¤„ç†æ—¶é—´è¿‡é•¿: ${Math.round(avgTime / 1000)}ç§’`,
          data: { avgTime },
        });
      }

      // æ£€æŸ¥æˆæœ¬
      const avgCost = this.average(metrics, 'cost');
      if (avgCost > 0.01) { // è¶…è¿‡ $0.01
        this.alerts.push({
          type: 'high_cost',
          severity: 'warning',
          message: `å¹³å‡æˆæœ¬åé«˜: $${avgCost.toFixed(4)}`,
          data: { avgCost },
        });
      }

      // æ£€æŸ¥é”™è¯¯ç‡
      const errorRate = 1 - metrics.filter(m => m.success).length / metrics.length;
      if (errorRate > 0.1) { // è¶…è¿‡ 10%
        this.alerts.push({
          type: 'error_spike',
          severity: 'critical',
          message: `é”™è¯¯ç‡è¿‡é«˜: ${(errorRate * 100).toFixed(1)}%`,
          data: { errorRate },
        });
      }

      return this.alerts;
    }

    private average(arr: any[], key: string): number {
      if (arr.length === 0) return 0;
      const sum = arr.reduce((s, item) => s + (item[key] || 0), 0);
      return sum / arr.length;
    }
  }

  export const performanceMonitor = new PerformanceMonitor();
  ```

#### äº¤ä»˜ç‰©

- [ ] `lib/ai/metrics.ts`
- [ ] `scripts/cost-analysis.ts`
- [ ] `lib/ai/monitor.ts`
- [ ] ç›‘æ§ä»ªè¡¨æ¿

#### éªŒæ”¶æ ‡å‡†

- [ ] æ‰€æœ‰å…³é”®æŒ‡æ ‡è¢«æ”¶é›†
- [ ] æˆæœ¬å¯å‡†ç¡®è®¡ç®—
- [ ] å¼‚å¸¸å¯åŠæ—¶å‘Šè­¦
- [ ] ä¼˜åŒ–å»ºè®®å¯è‡ªåŠ¨ç”Ÿæˆ

---

## ğŸš€ éƒ¨ç½²è®¡åˆ’

### ç¯å¢ƒé…ç½®

**æ–°å¢ç¯å¢ƒå˜é‡**ï¼š

```env
# ========== åˆè¯„é…ç½® ==========
PRELIMINARY_MODEL_ZH=deepseek-chat
PRELIMINARY_MODEL_EN=gemini-1.5-flash
PRELIMINARY_MODEL_OTHER=gpt-4o-mini
PRELIMINARY_MIN_VALUE=3

# ========== åˆ†æé…ç½® ==========
ANALYSIS_MODEL_ZH=deepseek-chat
ANALYSIS_MODEL_EN=gemini-1.5-pro
ANALYSIS_MODEL_OTHER=gpt-4o

# ========== åæ€é…ç½® ==========
REFLECTION_MODEL_ZH=deepseek-chat
REFLECTION_MODEL_EN=gpt-4o
REFLECTION_MODEL_OTHER=gpt-4o

# ========== é˜ˆå€¼é…ç½® ==========
SHORT_ARTICLE_THRESHOLD=6000
SEGMENT_ARTICLE_THRESHOLD=12000

# ========== åŠŸèƒ½å¼€å…³ ==========
ENABLE_PRELIMINARY=true
ENABLE_LANGUAGE_BRANCH=true
ENABLE_SMART_ANALYZER=true
ENABLE_FEEDBACK=false
```

### éƒ¨ç½²æ­¥éª¤

```bash
# 1. æ›´æ–°ä»£ç 
git pull origin main

# 2. å®‰è£…ä¾èµ–
npm install

# 3. æ•°æ®åº“è¿ç§»
npm run db:generate
npm run db:push

# 4. æ„å»ºåº”ç”¨
npm run build

# 5. å¯åŠ¨æœåŠ¡
# ç»ˆç«¯ 1: ä¸»åº”ç”¨
npm start

# ç»ˆç«¯ 2: åˆè¯„é˜Ÿåˆ—
npm run worker:preliminary

# ç»ˆç«¯ 3: æ·±åº¦åˆ†æé˜Ÿåˆ—
npm run worker:deep-analysis
```

### å›æ»šè®¡åˆ’

å¦‚æœå‡ºç°é—®é¢˜ï¼š

```bash
# 1. å…³é—­æ–°é˜Ÿåˆ—
npm run queue pause preliminary

# 2. å›æ»šä»£ç 
git revert <commit-hash>

# 3. é‡å¯æœåŠ¡
npm start
```

---

## ğŸ“ˆ ç›‘æ§æŒ‡æ ‡

### å…³é”®æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | ç›‘æ§æ–¹å¼ |
|------|------|---------|
| åˆè¯„é€šè¿‡ç‡ | 60-70% | é˜Ÿåˆ—ç»Ÿè®¡ |
| æ·±åº¦åˆ†ææˆæœ¬é™ä½ | > 35% | æˆæœ¬åˆ†æ |
| ä¸­æ–‡åˆ†æå‡†ç¡®ç‡ | > 90% | æŠ½æ ·æµ‹è¯• |
| è‹±æ–‡åˆ†æå‡†ç¡®ç‡ | > 85% | æŠ½æ ·æµ‹è¯• |
| çŸ­æ–‡å¤„ç†é€Ÿåº¦ | > 40% æå‡ | æ€§èƒ½æµ‹è¯• |
| é˜Ÿåˆ—å¤„ç†å»¶è¿Ÿ | < 30s | BullMQ ç›‘æ§ |
| é”™è¯¯ç‡ | < 5% | æ—¥å¿—åˆ†æ |

### å‘Šè­¦è§„åˆ™

```typescript
const alertRules = [
  {
    metric: 'processing_time',
    threshold: 60000, // 1 åˆ†é’Ÿ
    severity: 'warning',
  },
  {
    metric: 'error_rate',
    threshold: 0.1, // 10%
    severity: 'critical',
  },
  {
    metric: 'cost_per_article',
    threshold: 0.02, // $0.02
    severity: 'warning',
  },
];
```

---

## ğŸ¯ æˆåŠŸæ ‡å‡†

### Phase 1 å®Œæˆæ ‡å‡†

- [ ] åˆè¯„åŠŸèƒ½æ­£å¸¸è¿è¡Œ
- [ ] æ•°æ®åº“ Schema æ›´æ–°å®Œæˆ
- [ ] API æµ‹è¯•é€šè¿‡
- [ ] è¿‡æ»¤ç‡è¾¾åˆ° 30%+

### Phase 2 å®Œæˆæ ‡å‡†

- [ ] è¯­è¨€æ£€æµ‹å‡†ç¡®ç‡ > 95%
- [ ] ä¸­æ–‡åˆ†æå‡†ç¡®ç‡æå‡ > 5%
- [ ] è‹±æ–‡åˆ†æå‡†ç¡®ç‡æå‡ > 10%

### Phase 3 å®Œæˆæ ‡å‡†

- [ ] çŸ­æ–‡å¤„ç†é€Ÿåº¦æå‡ > 40%
- [ ] é•¿æ–‡å¤„ç†ä¸å—å½±å“
- [ ] åˆ†æè´¨é‡ä¸é™ä½

### æ•´ä½“å®Œæˆæ ‡å‡†

- [ ] æ·±åº¦åˆ†ææˆæœ¬é™ä½ > 35%
- [ ] æ•´ä½“å‡†ç¡®ç‡æå‡ > 10%
- [ ] ç”¨æˆ·åé¦ˆæ»¡æ„åº¦ > 80%
- [ ] ç³»ç»Ÿç¨³å®šæ€§ > 99%

---

## ğŸ“š å‚è€ƒèµ„æº

### æ–‡æ¡£

- `docs/AI-NATIVE-IMPROVEMENTS.md` - æ”¹è¿›å»ºè®®è¯¦ç»†è¯´æ˜
- `docs/AI-NATIVE-FLOW.md` - å®Œæ•´æµç¨‹è¯´æ˜
- `docs/AI-NATIVE-API.md` - API ä½¿ç”¨æ–‡æ¡£

### å·¥å…·

- BullMQ: https://docs.bullmq.io/
- Prisma: https://www.prisma.io/docs
- tRPC: https://trpc.io/docs

### æœ€ä½³å®è·µ

- æ¨¡å‹é€‰æ‹©: ä¼˜å…ˆä½¿ç”¨æ€§ä»·æ¯”é«˜çš„æ¨¡å‹
- é”™è¯¯å¤„ç†: æ‰€æœ‰å¼‚æ­¥æ“ä½œå¿…é¡»æ•è·é”™è¯¯
- æ—¥å¿—è®°å½•: å…³é”®æ“ä½œå¿…é¡»è®°å½•æ—¥å¿—
- æµ‹è¯•è¦†ç›–: æ ¸å¿ƒé€»è¾‘è¦†ç›–ç‡ > 80%

---

## ğŸ”„ æŒç»­æ”¹è¿›

### æ•°æ®é©±åŠ¨ä¼˜åŒ–

1. **æ¯å‘¨åˆ†æ**ï¼šæˆæœ¬ã€æ€§èƒ½ã€è´¨é‡æŠ¥å‘Š
2. **ç”¨æˆ·åé¦ˆ**ï¼šæ”¶é›†å’Œå¤„ç†ç”¨æˆ·åé¦ˆ
3. **A/B æµ‹è¯•**ï¼šæ–°åŠŸèƒ½ä¸Šçº¿å‰è¿›è¡Œå¯¹æ¯”æµ‹è¯•
4. **æ¨¡å‹æ›´æ–°**ï¼šå®šæœŸè¯„ä¼°å’Œæ›´æ–°æ¨¡å‹é€‰æ‹©

### ä¸‹ä¸€æ­¥è®¡åˆ’

- [ ] ç¿»è¯‘åŠŸèƒ½é›†æˆ
- [ ] å›¾ç‰‡å†…å®¹æå–
- [ ] å¤šè¯­è¨€æ”¯æŒæ‰©å±•
- [ ] è‡ªå®šä¹‰æ¨¡å‹æ¥å…¥
- [ ] API é™æµå’Œé…é¢

---

**æœ€åæ›´æ–°**: 2026-02-08
**ç»´æŠ¤è€…**: AI Team
